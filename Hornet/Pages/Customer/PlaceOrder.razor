@page "/placeOrder/{productId:int?}"
@using DataAccess.Data;
@using DataAccess.Models
@using DataAccess
@using Microsoft.EntityFrameworkCore;
@inject NavigationManager NavigationManager
@inject AppDbContext Context
@inject Hornet.Service.CartService CartService
@inject Hornet.Service.ProductService ProductService

<PageTitle>Beställ</PageTitle>


@if (Product is null)
{
    <!--Show Loading until the product is loaded-->
    <div>Loading...   </div>

}
else{
    <!--Show the selected product-->
<div class="container" style="overflow-y: auto; max-width: 400px;">
    <div class="row">
        <div class="col-md-10 mx-auto mb-4">
            <div class="card h-100">
                    <img src="@Product.ImagePath" class="card-img-top" alt="Card Image">
                <div class="card-body d-flex flex-column">
                        @if (Product.Alcohol > 0)
                        {
                            <h5 class="card-title">@Product.Name @Product.Alcohol %</h5>
                        }
                        else
                        {
                            <h5 class="card-title">@Product.Name</h5>
                        }
                        <h5 class="card-title">@(Product.Price.ToString("0.00")) kr</h5>
                        <p class="card-text">@Product.Description</p>
                        @if (Product.Vegan)
                        {
                            <p class="card-text">Vegansk</p>
                        }
                        @if (Product.Lactose)
                        {
                            <p class="card-text">Innehåller laktos</p>
                        }
                        @if (Product.Gluten)
                        {
                            <p class="card-text">Innehåller gluten</p>
                        }
                </div>
                    <div class="d-flex align-items-center mb-3">
                        <div class="input-group">
                            <!--Adjust the quantity to be added-->
                             <div class="input-group-prepend">
                                <button class="btn btn-outline-secondary" type="button" @onclick="DecreaseQuantity">-</button>
                             </div>

                             <input class="form-control" style="width: 8px"id="quantity" value="@Quantity" readonly />
                             
                             <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" @onclick="IncreaseQuantity">+</button>
                             </div>

                        </div>
                        <div class="ml-auto">
                            <!--Confirm adding the product/products-->
                            <a href="menu" class="btn btn-success" @onclick="AddToCart" >Beställ</a>
                        </div>
                    </div>
            </div>
        </div> 
    </div>
</div>
<div class="mb-4"></div>
   
 

}
@code {


    [Parameter]
    public int ProductId { get; set; }

    private Product Product { get; set; } = null;

    private int Quantity { get; set; } = 1;

    protected override async Task OnParametersSetAsync()
    {
        if (ProductId > 0)
        {
            int productId = ProductId;
            Product = await ProductService.GetByProductId(ProductId);

        }
    }
    private void AddToCart()
    {
        CartService.AddToCart(Product, Quantity);

    }

    private void IncreaseQuantity()
    {
        Quantity++;
    }

    private void DecreaseQuantity()
    {
        if(Quantity > 1)
        {
            Quantity--;
        }
    }
}


